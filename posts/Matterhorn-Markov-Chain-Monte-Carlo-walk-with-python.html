<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>How to climb the Matterhorn with a Markov Chain Monte Carlo walk | HealthyNumerics
</title>
  <link rel="canonical" href="https://alpynepyano.github.io/healthyNumerics/posts/Matterhorn-Markov-Chain-Monte-Carlo-walk-with-python.html">


  <link rel="apple-touch-icon" href="https://alpynepyano.github.io/healthyNumerics/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://alpynepyano.github.io/healthyNumerics/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://alpynepyano.github.io/healthyNumerics/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://alpynepyano.github.io/healthyNumerics/manifest.json">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/style.css">
 

<meta name="description" content="We let your robot climb the Matterhorn with a Markov Chain Monte Carlo walk">
<!-- base href="http://localhost:8000/output/images" / -->
<!-- base href="http://localhost:8000/" -->
<!--base href="/" / -->
</head>

<body>



       <!-- 
	   <div class="container-fluid"> <img class="img-fluid" src= "h01.jpg"> </div>
	   <div style="background-image: url(https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg) </div>
	   <style> body { background: #ffffff url("http://localhost:8000/images/b04.jpg") no-repeat center top; } </style>	 
	   <body background="bgimage.jpg">	   
	   body { background-image: url("img_tree.gif"), url("img_flwr.gif");
              background-color: #cccccc;
              }
	   -->

	  

  <header class="header">
    <div class="container">
      <div class="row">
	  
        <style> body { background: #ffffff 
		               url(https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg) no-repeat center top; }
		</style>
		<p class="text-hide"> .</p> <p class="text-hide"> .</p>
		<p class="text-hide"> .</p> <p class="text-hide"> .</p> <p class="text-hide"> .</p>
        <!--img  src="https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg"-->		
  
		
        <div class="col-sm-4">
          <a href="https://alpynepyano.github.io/healthyNumerics">
            <img class="img-fluid" src=https://alpynepyano.github.io/healthyNumerics/siteImages/profile.png alt="HealthyNumerics">
          </a>
        </div>
        <div class="col-sm-8">
		
      
		  <h1 class="title"   > <a style=" color:white" href="https://alpynepyano.github.io/healthyNumerics">HealthyNumerics</a> </h1>
		  
		  
		  <p style="color:white; font-size:16pt;"  > HealthPoliticsEconomics  |  Quant Analytics  |  Numerics </p>

		  
          <ul class="list-inline">
            <li class="list-inline-item"><a style="color:#ccccff;" href="http://derProjektor.ch/" target="_blank">der Projektor</a></li>
			<li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a style="color:#ccccff;" href="http://Abdagon.com/" target="_blank">Health Systems</a></li>
			<li class="list-inline-item text-muted">|</li>
			
			

		
			
            <li class="list-inline-item"><a class="fa fa-linkedin" style=" color:white;"   href="https://ch.linkedin.com/in/peter-schuhmacher" target="_blank"></a></li>
            <li class="list-inline-item text-muted">|</li>

		
			
            <li class="list-inline-item"><a class="fa fa-twitter" style=" color:white;"   href="https://twitter.com/PeSchuh" target="_blank"></a></li>
            <li class="list-inline-item text-muted">|</li>
          </ul>
        </div>
		
		
		
		
        <div class="col-sm-8">
		<ul class="list-inline">
		  <li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/categories.html">Categories</a></li>
		  <li class="list-inline-item text-muted">|</li>
			<li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/tags.html">Tags</a></li>
			<li class="list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/archives.html">Archives</a></li>
		  <li class="list-inline-item text-muted">|</li>
			<li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/authors.html">Authors</a></li>
          </ul>
        </div>
		
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>How to climb the Matterhorn with a Markov Chain Monte Carlo walk
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-05-12T09:35:00+02:00">
        <i class="fa fa-clock-o"></i>
        Sa 12 Mai 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/category/metaanalysis.html">MetaAnalysis</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/author/peter-schuhmacher.html">Peter Schuhmacher</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/tag/numerical.html">#numerical</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/statistics.html">#statistics</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/python.html">#python</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/bayesian.html">#bayesian</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h3>The information we have: a digital elevation model</h3>
<p>The Swiss national agency SWISSTOPO provides for demo purposes a digital elevation model (DEM) of the Matterhorn ( https://shop.swisstopo.admin.ch/en/products/height_models/dhm25 , see <em>'Sample data'</em>). It's a grid with 80 x 80 grid points. The grid size is 25 m. It covers an area of 2km x 2km with the peak of the Matterhorn in the center.</p>
<p>So the information we have is a table with figures indicating the <strong>height of topography</strong> at this piece of the earth:</p>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">Zinput</span><span class="p">[</span><span class="mi">33</span><span class="p">:</span><span class="mi">38</span><span class="p">,</span><span class="mi">33</span><span class="p">:</span><span class="mi">48</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="table-striped table-hover table dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>4277.008</td>
<td>4309.786</td>
<td>4341.514</td>
<td>4363.104</td>
<td>4370.490</td>
<td>4376.302</td>
<td>4372.981</td>
<td>4394.396</td>
<td>4414.586</td>
<td>4427.304</td>
<td>4434.690</td>
<td>4429.183</td>
<td>4400.208</td>
<td>4283.695</td>
<td>4238.506</td>
</tr>
<tr>
<th>1</th>
<td>4278.494</td>
<td>4299.690</td>
<td>4311.097</td>
<td>4326.480</td>
<td>4330.588</td>
<td>4326.087</td>
<td>4318.002</td>
<td>4320.187</td>
<td>4345.885</td>
<td>4364.590</td>
<td>4392.385</td>
<td>4389.282</td>
<td>4402.699</td>
<td>4325.082</td>
<td>4254.982</td>
</tr>
<tr>
<th>2</th>
<td>4246.285</td>
<td>4269.186</td>
<td>4277.401</td>
<td>4291.387</td>
<td>4292.304</td>
<td>4286.710</td>
<td>4274.080</td>
<td>4272.682</td>
<td>4268.005</td>
<td>4284.613</td>
<td>4306.595</td>
<td>4324.514</td>
<td>4330.414</td>
<td>4302.881</td>
<td>4264.597</td>
</tr>
<tr>
<th>3</th>
<td>4214.993</td>
<td>4238.681</td>
<td>4246.197</td>
<td>4260.488</td>
<td>4257.517</td>
<td>4256.293</td>
<td>4245.498</td>
<td>4232.780</td>
<td>4207.520</td>
<td>4223.690</td>
<td>4228.804</td>
<td>4228.017</td>
<td>4194.409</td>
<td>4223.603</td>
<td>4214.906</td>
</tr>
<tr>
<th>4</th>
<td>4179.200</td>
<td>4205.815</td>
<td>4215.518</td>
<td>4229.416</td>
<td>4222.204</td>
<td>4223.297</td>
<td>4218.402</td>
<td>4201.096</td>
<td>4148.695</td>
<td>4143.582</td>
<td>4141.484</td>
<td>4120.201</td>
<td>4107.308</td>
<td>4099.398</td>
<td>4115.087</td>
</tr>
</tbody>
</table>
</div>
<p>The isoline representation gives some more insight. The north-east crest (running from the top right corner to the peak of Matterhorn) is the <strong>Hörnligrat</strong>. It is the most often used ascent to the Matterhorn.</p>
<p>Even in the given representation with a spatial resolution of 25 m, the four main crests are clearly identifiable. The width of the crest has a scale of 2.5m which is fairly sharper than the gridsize of 25m. </p>
<p>At the top there is nothing like a plateau as one might belive due to isoline plot. <a href="https://upload.wikimedia.org/wikipedia/commons/8/88/Summit_of_the_Matterhorn.jpg">This photo</a> gives a certain impression about the real world situation: https://upload.wikimedia.org/wikipedia/commons/8/88/Summit_of_the_Matterhorn.jpg</p>
<div class="highlight"><pre><span></span><span class="n">plot_image_isoline</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span>
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2108/output_4_0.png"/></p>
<h1>The model: how to instruct your robot</h1>
<h3>The model rule</h3>
<p>Imagine you want to instruct your robot to explore the ascent to the peak of the Matterhorn: what rule do you implement the robot ?</p>
<p>Even if it sounds simple and stupide: <strong>"Go as steeply upward as you can"</strong> is a not too bad rule. Once on a crest it's the safest ascent that mountaineers usually prefer. And on the crest the rule is almost perfect: The steepest ascent is the way upward. The way back descends, and to the right und to the left too.</p>
<p>In the following we implement a simplified variant: We give the robot a reasonable starting point at the foot of the crest. There is a more general approach: We might let it rain and follow the traces of the runoff. There where is almost no water, there are the crests.</p>
<h3>Why is a Markov Chain  necessary ?</h3>
<p>Because the famous crest always seen on any postcard, called Hörnli-Grat (Grat = crest), is <strong>not</strong> a random assembly of independent rocks ! Only some repeated and preferred transition probabilies from one point to the next gives something as a crest. Without that there is no crest, and the Hörnli-Grat would be Hörnli only (which is some sort of pasta in this region, usually called macaroni).</p>
<p>How can we use this feature for implementation ? We can consider the topographic height <span class="math">\(\mathbf{H}\)</span> as velocity potential. The drift (given as velocity vector <span class="math">\(\mathbf{u}\)</span>) toward the higher probability of being  a crest is given as:</p>
<div class="math">$$
\mathbf{u}  = \mathbf{\nabla H} = \left[\begin{matrix}\frac{\partial{H}}{\partial{x}} \\ \frac{\partial{H}}{\partial{y}}\end{matrix}\right]
$$</div>
<p>An other approach is that we identify the regions of higher probability being a crest as the areas where the drift <span class="math">\(\mathbf{u}\)</span> is convergent. The convergence <span class="math">\(\gamma\)</span> is given as:</p>
<div class="math">$$
\gamma = -\mathbf{\nabla u}  = -\mathbf{\nabla(\nabla H)} = -\left(\begin{matrix}\frac{\partial^2{H}}{\partial{x^2}} + \frac{\partial^2{H}}{\partial{y^2}}\end{matrix}\right)
$$</div>
<p>For the latter approach we have mapped convergence <span class="math">\(\gamma\)</span> (<em>not shown here</em>) which uses 2 grid length (= 50m) to compute. It seems that the grid size ist too coarse to give a good result.</p>
<h3>What about Monte Carlo ?</h3>
<p>We let your explorer robot explore the ascent over the crest several times. For that we add some random drift to the mean drift. The trace of the robot is then like a dog's one looking for the trace of his master who is invisible hidden behind an obstacle: the running dog follows almost the master's trace, but not always exactely.</p>
<p>There are some practical reasons for doing that, as (i) the starting point might not be ideal, so it's better to adapt to a better trace. (ii) The crest may not always be a perfect crest. Our exploring robot had problems on the south-west crest, beceause the shoulder below the peak ressembles a plateau in the topographical data set, and the robot's walk become stuck. With a good portion of Monte Carlo power the robot was able to overcome this passage.</p>
<h3>What's the result ?</h3>
<p>The result is a 2-dimenaional PDF (probability density function) of the crests. So when you plan an expedition to the Matterhorn with 10 robots you may advise them to stay within the crest-PDF. For that you may implant them a <a href="Metropolis-Hasting-with-python.html">Metropolis-Hasting</a> chip in their GPS.</p>
<div class="highlight"><pre><span></span><span class="n">plot_trajectory</span><span class="p">(</span><span class="n">Xq</span><span class="p">,</span><span class="n">Yq</span><span class="p">,</span><span class="n">Zq</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">)</span>
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2108/output_7_0.png"/></p>
<div class="highlight"><pre><span></span><span class="n">Cp</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> <span class="n">Cp</span><span class="p">[</span><span class="n">C</span><span class="o">&gt;</span><span class="mi">150</span><span class="p">]</span><span class="o">=</span><span class="mi">150</span><span class="p">;</span>
<span class="n">plot_distribution</span><span class="p">(</span><span class="n">Xq</span><span class="p">,</span><span class="n">Yq</span><span class="p">,</span><span class="n">Zq</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">,</span><span class="n">Xq</span><span class="p">,</span><span class="n">Yq</span><span class="p">,</span><span class="n">Cp</span><span class="p">)</span>
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2108/output_8_0.png"/></p>
<h3><em>Python code</em></h3>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pyl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LightSource</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1">#--- read the imput file ------------------</span>
<span class="n">f200name</span> <span class="o">=</span> <span class="s1">'matterhorn25.asc'</span>
<span class="n">nHead</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1">#first 'nHead' rows to be skipped</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f200name</span><span class="p">,</span><span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f200</span><span class="p">:</span>
    <span class="n">Zinput</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">f200</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="n">nHead</span><span class="p">)</span>
    <span class="n">mx</span><span class="p">,</span><span class="n">my</span> <span class="o">=</span> <span class="n">Zinput</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1">#--- compute the grid -------</span>
<span class="n">xZero</span> <span class="o">=</span> <span class="mf">615987.5</span>
<span class="n">yZero</span> <span class="o">=</span> <span class="mf">90487.5</span>
<span class="n">gridsize</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gridsize</span><span class="p">,</span><span class="n">mx</span><span class="p">);</span>  <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>  <span class="n">x</span> <span class="o">=</span> <span class="n">xZero</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">gridsize</span><span class="p">,</span><span class="n">my</span><span class="p">);</span>  <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>  <span class="n">y</span> <span class="o">=</span> <span class="n">yZero</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>  <span class="c1"># X = ix.T * ones(iy)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># Y = ones(ix) * iy.T</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">Zinput</span>

<span class="c1">#--- unfortunately different systems have different matrix ordering......</span>
<span class="n">Xmg</span><span class="p">,</span><span class="n">Ymg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">Xm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">Xmg</span><span class="p">);</span>         <span class="n">Xn</span> <span class="o">=</span> <span class="n">Xmg</span><span class="p">;</span>                 <span class="n">Xq</span> <span class="o">=</span> <span class="n">X</span>
<span class="n">Ym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">Ymg</span><span class="p">);</span>         <span class="n">Yn</span> <span class="o">=</span> <span class="n">Ymg</span><span class="p">;</span>                 <span class="n">Yq</span> <span class="o">=</span> <span class="n">Y</span>
<span class="n">Zm</span> <span class="o">=</span> <span class="n">Zinput</span><span class="p">;</span>                 <span class="n">Zn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">Zinput</span><span class="p">);</span>   <span class="n">Zq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">Zinput</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1">#---- evaluate the potential -----------</span>
<span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">A</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dH</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">):</span>
    <span class="n">jx</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">jxm</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="n">jxp</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>
    <span class="n">jy</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">jym</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ny</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span> <span class="n">jyp</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>

    <span class="n">Hx</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">H</span><span class="p">);</span>   <span class="n">Hy</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
    <span class="n">Hxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">H</span><span class="p">);</span>   <span class="n">Hyy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>    

    <span class="n">Hx</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="n">jxp</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">-</span>  <span class="n">H</span><span class="p">[</span><span class="n">jxm</span><span class="p">,</span><span class="n">jy</span><span class="p">])</span>
    <span class="n">Hy</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jyp</span><span class="p">]</span> <span class="o">-</span>  <span class="n">H</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jym</span><span class="p">])</span>

    <span class="n">Hxx</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="n">jxp</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+</span> <span class="n">H</span><span class="p">[</span><span class="n">jxm</span><span class="p">,</span><span class="n">jy</span><span class="p">])</span>
    <span class="n">Hyy</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jyp</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+</span> <span class="n">H</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jym</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">Hxx</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">Hyy</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>

<span class="n">Hx</span><span class="p">,</span><span class="n">Hy</span><span class="p">,</span> <span class="n">Hxx</span><span class="p">,</span> <span class="n">Hyy</span> <span class="o">=</span> <span class="n">dH</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">my</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1">#---- the trajectory model ------</span>
<span class="k">def</span> <span class="nf">inField</span><span class="p">(</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">jx</span><span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="bp">False</span><span class="p">;</span> 
    <span class="k">if</span> <span class="n">jx</span><span class="o">&gt;</span><span class="n">nx</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">if</span> <span class="n">jy</span><span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="bp">False</span><span class="p">;</span> 
    <span class="k">if</span> <span class="n">jy</span><span class="o">&gt;</span><span class="n">ny</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">return</span> <span class="n">c</span>

<span class="k">def</span> <span class="nf">fem4</span><span class="p">(</span><span class="err">ξ</span><span class="p">,</span><span class="err">ν</span><span class="p">):</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="err">ξ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="err">ν</span><span class="p">);</span> <span class="n">f2</span> <span class="o">=</span> <span class="p">(</span><span class="err">ξ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="err">ν</span><span class="p">)</span>
    <span class="n">f3</span> <span class="o">=</span> <span class="p">(</span><span class="err">ξ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="err">ν</span><span class="p">);</span>     <span class="n">f4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="err">ξ</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="err">ν</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span>

<span class="k">def</span> <span class="nf">get_V</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
    <span class="err">ξ</span> <span class="o">=</span> <span class="p">(</span><span class="n">xp</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">jx</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">jx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">jx</span><span class="p">])</span>
    <span class="err">ν</span> <span class="o">=</span> <span class="p">(</span><span class="n">yp</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">jy</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">jy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">jy</span><span class="p">])</span>
    <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span> <span class="o">=</span> <span class="n">fem4</span><span class="p">(</span><span class="err">ξ</span><span class="p">,</span><span class="err">ν</span><span class="p">)</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">f1</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+</span> <span class="n">f2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">jx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+</span> <span class="n">f3</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">jx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f4</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> 
    <span class="n">vp</span> <span class="o">=</span> <span class="n">f1</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+</span> <span class="n">f2</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">jx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+</span> <span class="n">f3</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">jx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">jy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f4</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">up</span><span class="p">,</span><span class="n">vp</span>

<span class="k">def</span> <span class="nf">get_cell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="n">jx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">xp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">jy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">y</span><span class="o">&gt;=</span><span class="n">yp</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">inField</span><span class="p">(</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">):</span> 
        <span class="n">up</span><span class="p">,</span><span class="n">vp</span> <span class="o">=</span> <span class="n">get_V</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="n">C</span><span class="p">[</span><span class="n">jx</span><span class="p">,</span><span class="n">jy</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">up</span><span class="p">,</span><span class="n">vp</span><span class="p">,</span><span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">[],[],</span><span class="bp">False</span>

<span class="k">def</span> <span class="nf">run_randomWalk</span><span class="p">(</span><span class="n">nTraj</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>   
    <span class="k">def</span> <span class="nf">run_trajectories</span><span class="p">(</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">iTraj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTraj</span><span class="p">):</span>
            <span class="n">xp</span> <span class="o">=</span> <span class="n">xstart</span><span class="p">;</span>  <span class="n">yp</span> <span class="o">=</span> <span class="n">ystart</span>
            <span class="n">xtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xp</span><span class="p">])</span>
            <span class="n">ytr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">yp</span><span class="p">])</span>
            <span class="n">runT</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">runT</span> <span class="o">&lt;</span> <span class="n">runTmax</span><span class="p">:</span>
                <span class="n">runT</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">up</span><span class="p">,</span><span class="n">vp</span><span class="p">,</span><span class="n">flag</span> <span class="o">=</span> <span class="n">get_cell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">runT</span> <span class="o">==</span> <span class="n">runTmax</span><span class="p">:</span> <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="n">upp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span> 
                    <span class="n">vpp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span> 
                    <span class="n">xp</span> <span class="o">=</span> <span class="n">xp</span> <span class="o">+</span> <span class="p">(</span><span class="n">up</span><span class="o">+</span><span class="n">upp</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>  <span class="n">xtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xtr</span><span class="p">,</span> <span class="n">xp</span><span class="p">)</span>
                    <span class="n">yp</span> <span class="o">=</span> <span class="n">yp</span> <span class="o">+</span> <span class="p">(</span><span class="n">vp</span><span class="o">+</span><span class="n">vpp</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">;</span>  <span class="n">ytr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ytr</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">xts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">xts</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">xtr</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">yts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">yts</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ytr</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">break</span> 
        <span class="k">return</span> <span class="n">xts</span><span class="p">,</span><span class="n">yts</span>         
    <span class="n">xts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">yts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">runTmax</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="k">for</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xStart</span><span class="p">,</span><span class="n">yStart</span><span class="p">):</span>
        <span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="o">=</span><span class="n">run_trajectories</span><span class="p">(</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">,</span><span class="n">C</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1">#------ main: Random Walk ---------- </span>
<span class="n">xStart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mi">616750</span><span class="p">,</span> <span class="mi">617900</span><span class="p">,</span> <span class="mi">617950</span><span class="p">,</span> <span class="mi">616250</span><span class="p">])</span>
<span class="n">yStart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>  <span class="mi">90600</span><span class="p">,</span> <span class="mi">91250</span><span class="p">,</span>  <span class="mi">92400</span><span class="p">,</span>  <span class="mi">92400</span><span class="p">])</span>

<span class="n">u</span> <span class="o">=</span>  <span class="n">Hy</span> 
<span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">Hx</span> 

<span class="n">x</span> <span class="o">=</span> <span class="n">Xq</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Yq</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="n">nx</span> <span class="o">=</span> <span class="n">mx</span><span class="p">;</span>  <span class="n">ny</span> <span class="o">=</span> <span class="n">my</span>

<span class="n">nTraj</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">500</span> <span class="p">,</span><span class="mf">0.45</span><span class="p">,</span>  <span class="mf">25.755</span>
<span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">,</span><span class="n">C</span> <span class="o">=</span> <span class="n">run_randomWalk</span><span class="p">(</span><span class="n">nTraj</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span> 
</pre></div>
<h3><em>Graphics</em></h3>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_image_isoline</span><span class="p">(</span><span class="n">zImg</span><span class="p">,</span><span class="n">zIso</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span> 
    <span class="n">pyl</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">zImg</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'bilinear'</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>   
    <span class="n">CS</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">zIso</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Matterhorn (grid size 25m x 25m)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
    <span class="n">pyl</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">pyl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_trajectory</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'fivethirtyeight'</span><span class="p">):</span> 
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span> 
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="c1">#q0 = ax1.quiver(X, Y, u, v, R, angles='xy', alpha=.92, cmap=plt.cm.plasma)</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1">#p = plt.quiverkey(q0,1,0.5,2,"2 m/s",coordinates='data',color='r')</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'-'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.65</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Some trajectories of Matterhorn Markov Chain Monte Carlo walk'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_distribution</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">xts</span><span class="p">,</span><span class="n">yts</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">C</span><span class="p">):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'fivethirtyeight'</span><span class="p">):</span> 
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">32</span><span class="p">))</span> 
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="c1">#q0 = ax2.quiver(X, Y, u, v, R, angles='xy', alpha=.92, cmap=plt.cm.plasma)</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s2">"2 m/s"</span><span class="p">,</span><span class="n">coordinates</span><span class="o">=</span><span class="s1">'data'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'r'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span> <span class="n">C</span> <span class="p">,</span>  <span class="mi">20</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'PDF of Matterhorn crests'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">'equal'</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hillshade</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">azimuth</span><span class="p">,</span> <span class="n">elevation</span><span class="p">):</span>
    <span class="n">rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
    <span class="n">azimuth</span> <span class="o">=</span> <span class="p">(</span><span class="mf">360.0</span> <span class="o">-</span> <span class="n">azimuth</span><span class="p">)</span><span class="o">*</span><span class="n">rad</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">elevation</span><span class="o">*</span><span class="n">rad</span> 

    <span class="n">hx</span><span class="p">,</span> <span class="n">hy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">slope</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hx</span><span class="o">*</span><span class="n">hx</span> <span class="o">+</span> <span class="n">hy</span><span class="o">*</span><span class="n">hy</span><span class="p">))</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">)</span>

    <span class="n">grey_shading</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
                  <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">elevation</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>\
                    <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">azimuth</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="n">aspect</span><span class="p">)</span>
    <span class="n">shaded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">grey_shading</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grey_shading</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plotSurface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">hShade</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">'3d'</span><span class="p">),</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="mi">41</span><span class="p">))</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">LightSource</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">shade</span><span class="p">(</span><span class="n">hShade</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gist_earth</span><span class="p">,</span> <span class="n">vert_exag</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">blend_mode</span><span class="o">=</span><span class="s1">'soft'</span><span class="p">)</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">facecolors</span><span class="o">=</span><span class="n">rgb</span><span class="p">,</span>
                           <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="bp">False</span> <span class="p">)</span>
    <span class="n">hight_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
    <span class="n">rotation_angle</span> <span class="o">=</span> <span class="mi">120</span>  <span class="c1"># 0=von S; 90=von E; 180=von N</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">hight_angle</span><span class="p">,</span> <span class="n">rotation_angle</span><span class="p">)</span>

    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">);</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Y</span><span class="p">);</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Z</span><span class="p">);</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span><span class="mf">1.1</span><span class="o">*</span><span class="n">zmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="sd">'''    </span>
<span class="sd">    plt.xlabel(r'x (west --&gt; east)',  fontsize=40)</span>
<span class="sd">    plt.ylabel(r'y (south --&gt; north)',fontsize=40)</span>
<span class="sd">    tickFontsize=40</span>
<span class="sd">    plt.xticks(fontsize = tickFontsize, rotation=270);</span>
<span class="sd">    plt.yticks(fontsize = tickFontsize, rotation= 90);</span>
<span class="sd">    plt.tick_params(which='major', length=20, width=10)</span>
<span class="sd">    '''</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Matterhorn'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">zShade</span> <span class="o">=</span> <span class="n">hillshade</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">plotSurface</span><span class="p">(</span><span class="n">Xq</span><span class="p">,</span><span class="n">Yq</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">zShade</span><span class="p">)</span>
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2108/output_22_0.png"/></p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
</article>
<hr>
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() {
    this.page.url = 'https://alpynepyano.github.io/healthyNumerics/posts/Matterhorn-Markov-Chain-Monte-Carlo-walk-with-python.html';
    this.page.identifier = 'Matterhorn-Markov-Chain-Monte-Carlo-walk-with-python';
  };
  (function() {
    var d = document;
    var s = d.createElement('script');
    s.src = '//healthynumerics.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript class="text-muted">
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
	      <li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/categories.html">Categories</a></li>
			<li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/tags.html">Tags</a></li>
          <li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/archives.html">Archives</a></li>
			<li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/authors.html">Authors</a></li>
        </ul>	
        <p style="color:#C0C0C0;"> 
		    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> 
		    based on the <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">alchemy &#x2728;</a> theme
           </p>
      </div>
    </div>
  </footer>
</body>

</html>