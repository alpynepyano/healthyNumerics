<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Dynamics of heat flux with an inplicite time dependent FVM-model | HealthyNumerics
</title>
  <link rel="canonical" href="https://alpynepyano.github.io/healthyNumerics/posts/cfd-dynamics-of-heat-flux-finite-volume-with-python.html">


  <link rel="apple-touch-icon" href="https://alpynepyano.github.io/healthyNumerics/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://alpynepyano.github.io/healthyNumerics/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://alpynepyano.github.io/healthyNumerics/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://alpynepyano.github.io/healthyNumerics/manifest.json">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/style.css">
 

<meta name="description" content="We model the dynamics of solar heating and of the heat ground flux. We can reconstruct why the peak of heat is in the afternoon and not at noon (when the sun is in the zenith).">
<!-- base href="http://localhost:8000/output/images" / -->
<!-- base href="http://localhost:8000/" -->
<!--base href="/" / -->
</head>

<body>



       <!-- 
	   <div class="container-fluid"> <img class="img-fluid" src= "h01.jpg"> </div>
	   <div style="background-image: url(https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg) </div>
	   <style> body { background: #ffffff url("http://localhost:8000/images/b04.jpg") no-repeat center top; } </style>	 
	   <body background="bgimage.jpg">	   
	   body { background-image: url("img_tree.gif"), url("img_flwr.gif");
              background-color: #cccccc;
              }
	   -->

	  

  <header class="header">
    <div class="container">
      <div class="row">
	  
        <style> body { background: #ffffff 
		               url(https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg) no-repeat center top; }
		</style>
		<p class="text-hide"> .</p> <p class="text-hide"> .</p>
		<p class="text-hide"> .</p> <p class="text-hide"> .</p> <p class="text-hide"> .</p>
        <!--img  src="https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg"-->		
  
		
        <div class="col-sm-4">
          <a href="https://alpynepyano.github.io/healthyNumerics">
            <img class="img-fluid" src=https://alpynepyano.github.io/healthyNumerics/siteImages/profile.png alt="HealthyNumerics">
          </a>
        </div>
        <div class="col-sm-8">
		
      
		  <h1 class="title"   > <a style=" color:white" href="https://alpynepyano.github.io/healthyNumerics">HealthyNumerics</a> </h1>
		  
		  
		  <p style="color:white; font-size:16pt;"  > HealthPoliticsEconomics  |  Quant Analytics  |  Numerics </p>

		  
          <ul class="list-inline">
            <li class="list-inline-item"><a style="color:#ccccff;" href="http://derProjektor.ch/" target="_blank">der Projektor</a></li>
			<li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a style="color:#ccccff;" href="http://Abdagon.com/" target="_blank">Health Systems</a></li>
			<li class="list-inline-item text-muted">|</li>
			
			

		
			
            <li class="list-inline-item"><a class="fa fa-linkedin" style=" color:white;"   href="https://ch.linkedin.com/in/peter-schuhmacher" target="_blank"></a></li>
            <li class="list-inline-item text-muted">|</li>

		
			
            <li class="list-inline-item"><a class="fa fa-twitter" style=" color:white;"   href="https://twitter.com/PeSchuh" target="_blank"></a></li>
            <li class="list-inline-item text-muted">|</li>
          </ul>
        </div>
		
		
		
		
        <div class="col-sm-8">
		<ul class="list-inline">
		  <li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/categories.html">Categories</a></li>
		  <li class="list-inline-item text-muted">|</li>
			<li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/tags.html">Tags</a></li>
			<li class="list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/archives.html">Archives</a></li>
		  <li class="list-inline-item text-muted">|</li>
			<li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/authors.html">Authors</a></li>
          </ul>
        </div>
		
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>Dynamics of heat flux with an inplicite time dependent FVM-model
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2018-10-27T12:55:00+02:00">
        <i class="fa fa-clock-o"></i>
        Sa 27 Oktober 2018
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/category/computationalfluiddynamics.html">ComputationalFluidDynamics</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/author/peter-schuhmacher.html">Peter Schuhmacher</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/tag/flow-model.html">#flow model</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/fvm.html">#FVM</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/curvilinear-grid.html">#curvilinear grid</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h1>Example</h1>
<h3>The mathematics of discretization</h3>
<ul>
<li>is in detail given  <a href="cfd_implicite_time_dependent_heat_flow_model_finite_volume.html">here</a></li>
</ul>
<p>We solve the time dependent (= instationary) diffusion equation</p>
<div class="math">$$
\begin{align}
T_t &amp; =   \nabla\,(\Gamma\, \nabla T) + f(t) \\
             &amp; = (\Gamma\,T_{x})_x+ f(t) \\
\end{align}
$$</div>
<ul>
<li><span class="math">\(f(t)\)</span> is the solar heating. It is time dependent according to the (relative) diurnal movement of the sun.</li>
<li>the sun heats the ground and is the forcing term.</li>
<li><span class="math">\(T\)</span> is the evolving (<em>distribution of the</em>) temperature.</li>
<li>during the morning hours there is a heat transport into the ground.</li>
<li>But in the afternoon, when the solar force is declining, there is a heat flux from the ground into the atmosphere.</li>
<li>The sum of the solar heating and the ground flux towards the atmosphere makes that the peak of the heat is in the afternoon and not at noon (when the sun is in the zenith).</li>
</ul>
<h3>Implicit (Euler backward) time schema</h3>
<p>The implicit time schema the tendency term <span class="math">\(\mathbf{T}_t\)</span> is discretizised as</p>
<div class="math">$$
\mathbf{T}_t = \frac{ \mathbf{T}^{n} - \mathbf{T}^{n-1}  }{\Delta t} =  \mathbf{D \, T}^n + \mathbf{f}
$$</div>
<p>The unknown quantity <span class="math">\(\mathbf{T}^{n}\)</span> is  on the left side of the equation including the equation system which has to be solved at each time step</p>
<div class="math">$$
\begin{align}
\mathbf{T}^{n} -  \Delta t \, \mathbf{D \, T}^n &amp; = \mathbf{T}^{n-1}  + \Delta t \,\mathbf{f} \\
(\mathbf{I} -  \Delta t \, \mathbf{D}) \, \mathbf{T}^n &amp; = \mathbf{T}^{n-1}  + \Delta t \,\mathbf{f}
\end{align}
$$</div>
<p>The stencil for the implicit schema is now
</p>
<div class="math">$$
\begin{array}{c|c|c|c}
\hline
T_W  &amp; T_P  &amp; T_E &amp; b_P\\
\hline
D_W = -\Delta t \frac{\Gamma_w S_w}{d_W} &amp; D_P = 1-(-D_W - D_E) &amp; D_E = -\Delta t \frac{\Gamma_e S_e}{d_E} &amp; \overline{f_P}\cdot \Delta V_P\\
\hline
\end{array}
$$</div>
<p>Introducing <span class="math">\(\tilde{\mathbf{A}}\)</span> we find the following form of discretisation:</p>
<div class="math">$$
\begin{align}
\tilde{\mathbf{A}} &amp; :=  (\mathbf{I} - \Delta t \,\,\mathbf{D} )  \\
\tilde{\mathbf{A}} \mathbf{u}^n &amp; = \mathbf{b}^{n-1}
\end{align}
$$</div>
<h1>Implementation</h1>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="kn">as</span> <span class="nn">sps</span>
<span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">bicgstab</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
<h3>Signals</h3>
<p>This are auxiliary functions to initialize the parameter values. We have prepared a collection of signals <a href="https://alpynepyano.github.io/healthyNumerics/posts/ecg-waves-python.html">here</a></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">signal</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>            <span class="k">return</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">add_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">uSignal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>          <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wSignal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">dt</span><span class="p">):</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uSignal</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">uSignal</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">expSignal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">minus_exp_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
<h3>The FVM grid</h3>
<p>We generate a 1-dimensional grid with irregular spacing between the grid points. We start with the location of the faces and compute then the grid point in the center.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">grid1D</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nxc</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span> <span class="n">sCase</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxc</span> <span class="o">=</span> <span class="n">nxc</span>                                                         <span class="c1"># number of faces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lx</span> <span class="o">=</span> <span class="n">Lx</span>                                                           <span class="c1"># length of x-domain</span>
        <span class="n">sT</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'stretch_regular'</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">stretch_regular</span><span class="p">,</span>                          <span class="c1"># mapping of stretching types</span>
              <span class="s1">'stretch_exp'</span>    <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">stretch_exp</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretchT</span> <span class="o">=</span> <span class="n">sT</span><span class="p">[</span><span class="n">sCase</span><span class="p">]</span>                                              <span class="c1"># selects the type of stretching</span>
    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>                    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">a</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="c1"># scaling to [0..1]</span>
    <span class="k">def</span> <span class="nf">xi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                          <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="p">)</span> <span class="c1"># logical/computational grid</span>
    <span class="k">def</span> <span class="nf">stretch_regular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>             <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="p">)</span> <span class="c1"># regular grid, no stretching</span>
    <span class="k">def</span> <span class="nf">stretch_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                     <span class="c1"># exponantial stretching</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xi</span><span class="p">();</span>                    <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ix</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">xc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stretchT</span><span class="p">()</span>      <span class="c1"># face x-coordinate</span>
    <span class="k">def</span> <span class="nf">xp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                          <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">centerPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">())</span>  <span class="c1"># center point coordinate</span>
    <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                                                              <span class="c1"># spacing between P's</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stretchT</span><span class="p">()</span>
        <span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">xc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">centerPoint</span><span class="p">(</span><span class="n">xc</span><span class="p">),</span><span class="n">xc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">centerPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> <span class="n">mx</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">mx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">mx</span><span class="p">])</span>    <span class="c1"># center point P method</span>
    <span class="k">def</span> <span class="nf">Swe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>                          <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="p">))</span>          <span class="c1"># areas of the faces west-east</span>
    <span class="k">def</span> <span class="nf">cvP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Swe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Swe</span><span class="p">();</span> <span class="n">mx</span><span class="o">=</span><span class="n">Swe</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Swe</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">mx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Swe</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">mx</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xc</span><span class="p">())</span>                 <span class="c1"># volumes of the CV</span>

<span class="c1">#--- MAIN -------------------------------------------------------</span>
<span class="c1">#--- Input ------------------------------------------------------    </span>
<span class="n">nxc</span> <span class="o">=</span> <span class="mi">28</span>                               <span class="c1"># number of faces/corners</span>
<span class="n">Lx</span>  <span class="o">=</span> <span class="mf">0.02</span>                             <span class="c1"># length of x-domain</span>
<span class="c1">#Lx  = 0.3                             # length of x-domain</span>
<span class="n">nxp</span> <span class="o">=</span> <span class="n">nxc</span><span class="o">-</span><span class="mi">1</span>                            <span class="c1"># number of central points P     </span>
<span class="c1">#g  = grid1D(nxc,Lx,'stretch_regular') # 2 types</span>
<span class="n">g</span>   <span class="o">=</span> <span class="n">grid1D</span><span class="p">(</span><span class="n">nxc</span><span class="p">,</span><span class="n">Lx</span><span class="p">,</span><span class="s1">'stretch_exp'</span><span class="p">)</span>     <span class="c1"># type of grid strechting</span>
</pre></div>
<h3>Graphics of the grid</h3>
<div class="highlight"><pre><span></span><span class="c1">#--- Graphics -----------------</span>
<span class="c1">#--- plot the grid ------------</span>
<span class="n">xc</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">xc</span><span class="p">()</span>                            <span class="c1"># get the corners/faces points w, e</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">xp</span><span class="p">()</span>                            <span class="c1"># get the central points P</span>

<span class="k">def</span> <span class="nf">plot_grid</span><span class="p">(</span><span class="n">ax0</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span> <span class="n">y_base</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">y_base</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">xc</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">"|"</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span> <span class="p">)</span>
    <span class="n">ax0</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">y_base</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">xp</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'r'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'fast'</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">ax0</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">xp</span><span class="p">)</span>
    <span class="n">grid_legend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">'xc: face points w'</span><span class="p">,</span> <span class="s1">'xp: center grid points P'</span> <span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">grid_legend</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Finite Volume Grid"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img5302/output_9_0.png"/></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">system1D</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span><span class="n">case</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxc</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">nxc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">=</span> <span class="n">case</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nxp</span><span class="p">))</span>             <span class="c1"># initialize local rhs</span>
    <span class="k">def</span> <span class="nf">DWE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gam</span><span class="p">()</span><span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">Swe</span><span class="p">()</span><span class="o">/</span><span class="n">g</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>        <span class="c1"># build the non-zero elements of the system matrix  </span>
    <span class="c1">#----- input section ------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>         
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">==</span><span class="s1">'B'</span><span class="p">:</span>   <span class="k">return</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nxp</span><span class="p">))</span>  <span class="c1"># initial value, random gauss [-0.1 .. +0.1]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">==</span><span class="s1">'C'</span><span class="p">:</span>   <span class="k">return</span> <span class="mf">273.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nxp</span><span class="p">))</span>           
    <span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">g</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">==</span><span class="s1">'B'</span><span class="p">:</span>   <span class="k">return</span> <span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span><span class="n">g</span><span class="o">.</span><span class="n">cvP</span><span class="p">()</span>       <span class="c1"># set source term</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span><span class="o">==</span><span class="s1">'C'</span><span class="p">:</span>   <span class="k">return</span> <span class="mf">0.00</span>                        <span class="c1"># set source term</span>
    <span class="k">def</span> <span class="nf">gam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">==</span><span class="s1">'B'</span><span class="p">:</span>  <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="p">))</span>     <span class="c1"># set diffusion coefficient</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">==</span><span class="s1">'C'</span><span class="p">:</span>  <span class="k">return</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nxc</span><span class="p">))</span>     <span class="c1"># set diffusion coefficient</span>
    <span class="k">def</span> <span class="nf">T_west_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">==</span><span class="s1">'B'</span><span class="p">:</span> <span class="k">return</span> <span class="mf">100.0</span>                       <span class="c1"># set T_fix at w-boundary</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">==</span><span class="s1">'C'</span><span class="p">:</span> <span class="k">return</span> <span class="mf">273.0</span>                       <span class="c1"># set T_fix at w-boundary</span>
    <span class="k">def</span> <span class="nf">T_east_fix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">==</span><span class="s1">'B'</span><span class="p">:</span> <span class="k">return</span> <span class="mf">200.0</span>                       <span class="c1"># set T_fix at e-boundary</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">case</span> <span class="o">==</span><span class="s1">'C'</span><span class="p">:</span> <span class="k">return</span> <span class="mf">273.0</span>                       <span class="c1"># set T_fix at e-boundary</span>

<span class="k">def</span> <span class="nf">insert_boundary_conditions</span><span class="p">(</span><span class="n">sT</span><span class="p">,</span><span class="n">DWE</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="c1">#----- input section ------------------------------------------------------------------------------</span>
    <span class="n">west_fix</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c1">#---- west boundary                       # select type of boundary condition at w</span>
    <span class="k">if</span> <span class="n">west_fix</span><span class="p">:</span>
        <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sT</span><span class="o">.</span><span class="n">T_west_fix</span><span class="p">()</span> <span class="o">*</span> <span class="n">DWE</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  
    <span class="k">else</span><span class="p">:</span> <span class="n">T_west_flux</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">DWE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_west_flux</span>

    <span class="n">east_fix</span> <span class="o">=</span> <span class="bp">True</span>   <span class="c1">#---- east boundary                      # select type of boundary condition at e</span>
    <span class="k">if</span> <span class="n">east_fix</span><span class="p">:</span>
        <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="n">sT</span><span class="o">.</span><span class="n">T_east_fix</span><span class="p">()</span> <span class="o">*</span> <span class="n">DWE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">DWE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">return</span> <span class="n">DWE</span><span class="p">,</span><span class="n">b</span>
</pre></div>
<h1>Time dependent algorithm</h1>
<p>In this example the w-boundary oscillates with a sin-wave. The equations system has to be solved at each time step. After each time step the right hand side (RHS) has to be updated. It contains the solution of the previous time step.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve_timedependent_system</span><span class="p">(</span><span class="n">DWE</span><span class="p">,</span><span class="n">RHS</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">bT</span><span class="p">,</span><span class="n">ax0</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">print_convergence</span><span class="p">(</span><span class="n">cc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cc</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">"bicg-stab: successful exit --&gt; c ="</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cc</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">"bicg-stab: convergence to tolerance not achieved, number of iterations is = "</span><span class="p">,</span> <span class="n">cc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cc</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">"bicg-stab: illegal input or breakdown --&gt; c ="</span><span class="p">,</span><span class="n">cc</span><span class="p">)</span>

    <span class="c1">#---- set integration time and time step</span>
    <span class="n">tbegin</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.085</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">nTimeSteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="p">(</span><span class="n">tend</span><span class="o">-</span><span class="n">tbegin</span><span class="p">)</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'nTimeSteps'</span><span class="p">,</span> <span class="n">nTimeSteps</span><span class="p">)</span>

    <span class="c1">#---- center P ----</span>
    <span class="n">DP</span> <span class="o">=</span>  <span class="mf">1.0</span> <span class="o">-</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="o">-</span> <span class="n">DWE</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nxp</span><span class="p">]</span> <span class="o">-</span> <span class="n">DWE</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nxc</span><span class="p">]);</span>  
    <span class="c1">#---- system matrix D ----</span>
    <span class="n">DW</span> <span class="o">=</span>  <span class="o">-</span><span class="n">dt</span><span class="o">*</span><span class="n">DWE</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nxp</span><span class="p">];</span>   <span class="n">DE</span> <span class="o">=</span> <span class="o">-</span><span class="n">dt</span><span class="o">*</span><span class="n">DWE</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">nxp</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">sps</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span> <span class="n">diagonals</span><span class="o">=</span><span class="p">[</span><span class="n">DW</span><span class="p">,</span> <span class="n">DP</span><span class="p">,</span> <span class="n">DE</span><span class="p">],</span>
                     <span class="n">offsets</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>
                     <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nxp</span><span class="p">,</span> <span class="n">nxp</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">'csr'</span><span class="p">)</span>

    <span class="c1">#---- numerical solver -----</span>
    <span class="n">Gflux</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTimeSteps</span><span class="p">))</span>                <span class="c1"># will evaluate the ground flux</span>
    <span class="n">Sflux</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nTimeSteps</span><span class="p">))</span>                <span class="c1"># will evaluate the 'solar' flux</span>
    <span class="k">for</span> <span class="n">jt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nTimeSteps</span><span class="p">):</span>             <span class="c1"># the time loop</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">jt</span><span class="o">*</span><span class="n">dt</span>
        <span class="n">T_west_fix</span> <span class="o">=</span> <span class="mi">273</span> <span class="o">+</span> <span class="mf">10.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>        <span class="c1"># update boundary value T[n]</span>
        <span class="n">RHS</span>     <span class="o">=</span> <span class="n">T</span>                              <span class="c1"># update the RHS with T[n-1]</span>
        <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">T_west_fix</span> <span class="o">*</span> <span class="n">DWE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># w BC: update the RHS with T[n-1]</span>
        <span class="n">RHS</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">bT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>              <span class="c1"># e BC: update the RHS with T[n-1]</span>

        <span class="n">X</span> <span class="o">=</span> <span class="n">bicgstab</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">RHS</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="bp">None</span><span class="p">);</span>  
        <span class="n">T</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Sflux</span><span class="p">[</span><span class="n">jt</span><span class="p">]</span> <span class="o">=</span> <span class="n">T_west_fix</span>
        <span class="n">Gflux</span><span class="p">[</span><span class="n">jt</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">jt</span><span class="o">%</span><span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">T</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'t ='</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jt</span><span class="p">));</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">T</span><span class="p">,</span><span class="n">Sflux</span><span class="p">,</span><span class="n">Gflux</span>

<span class="c1">#----- main --------------------</span>
<span class="n">sig</span>    <span class="o">=</span> <span class="n">signal</span><span class="p">()</span>                               <span class="c1"># get access to the signals</span>
<span class="n">sT</span>     <span class="o">=</span> <span class="n">system1D</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">sig</span><span class="p">,</span><span class="n">case</span><span class="o">=</span><span class="s1">'C'</span><span class="p">)</span>               <span class="c1"># instantiate a system for this case</span>
<span class="n">qT</span>     <span class="o">=</span> <span class="n">sT</span><span class="o">.</span><span class="n">q</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>                                <span class="c1"># set the source term</span>
<span class="c1">#---- main ---------------------</span>
<span class="n">DWE</span>    <span class="o">=</span> <span class="n">sT</span><span class="o">.</span><span class="n">DWE</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>                              <span class="c1"># build the non-zero elements of the system matrix</span>
<span class="n">bT</span>     <span class="o">=</span> <span class="n">sT</span><span class="o">.</span><span class="n">b</span><span class="p">()</span>                                 <span class="c1"># initialize the local rhs of this system</span>
<span class="n">DWE</span><span class="p">,</span><span class="n">bT</span> <span class="o">=</span> <span class="n">insert_boundary_conditions</span><span class="p">(</span><span class="n">sT</span><span class="p">,</span><span class="n">DWE</span><span class="p">,</span><span class="n">bT</span><span class="p">)</span>  <span class="c1"># insert the boundary conditions: changes DWE and b</span>
<span class="n">RHS</span>    <span class="o">=</span> <span class="n">bT</span><span class="o">+</span><span class="n">qT</span>                                  <span class="c1"># update the right hand side of the complete system</span>
<span class="n">T</span>      <span class="o">=</span> <span class="n">sT</span><span class="o">.</span><span class="n">T</span><span class="p">()</span>                                 <span class="c1"># initialize T</span>

<span class="c1">#---- graphics ----------------------</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'fast'</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">plot_grid</span><span class="p">(</span><span class="n">ax0</span><span class="p">,</span><span class="n">xc</span><span class="p">,</span><span class="n">xp</span><span class="p">,</span> <span class="n">y_base</span><span class="o">=</span><span class="mi">263</span><span class="p">)</span>
    <span class="c1">#--- run the time-dependent solution ---------------------</span>
    <span class="n">T</span><span class="p">,</span><span class="n">Sflux</span><span class="p">,</span><span class="n">Gflux</span> <span class="o">=</span> <span class="n">solve_timedependent_system</span><span class="p">(</span><span class="n">DWE</span><span class="p">,</span><span class="n">RHS</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">bT</span><span class="p">,</span><span class="n">ax0</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'y'</span><span class="p">);</span> <span class="c1">#plt.legend(prop={'size': 15})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Time dependent solar heating and soil heat flux"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'fast'</span><span class="p">):</span>
    <span class="n">mg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Gflux</span><span class="p">)</span>
    <span class="n">tt</span> <span class="o">=</span><span class="p">(</span> <span class="mi">24</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mg</span><span class="p">)</span><span class="o">/</span><span class="n">mg</span><span class="p">)</span>
    <span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">tt</span><span class="p">[</span><span class="mi">6</span><span class="p">:],</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">Gflux</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">Sflux</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">S</span><span class="o">+</span><span class="n">G</span>
    <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">S</span><span class="p">);</span> <span class="n">sx</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
    <span class="n">fy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">F</span><span class="p">);</span> <span class="n">fx</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">G</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">G</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Ground flux (scaled)'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">S</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">':'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Solar flux (scaled)'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span><span class="n">F</span><span class="p">,</span> <span class="s1">'k--'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'netto flux'</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'peak of solar position'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">fx</span><span class="p">,</span><span class="n">fy</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span> <span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'peak of heat'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">sx</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">fx</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">fy</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="s1">'Soil flux into the ground'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">'Soil flux into the atmosphere'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">tt</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Solar hour'</span><span class="p">),</span>  <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'rel. flux'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Time shitft between peak of solar position and peak of heat"</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span><span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span>nTimeSteps 24
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img5302/output_12_1.png"/></p>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img5302/output_12_2.png"/></p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
</article>
<hr>
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() {
    this.page.url = 'https://alpynepyano.github.io/healthyNumerics/posts/cfd-dynamics-of-heat-flux-finite-volume-with-python.html';
    this.page.identifier = 'cfd-dynamics-of-heat-flux-finite-volume-with-python';
  };
  (function() {
    var d = document;
    var s = d.createElement('script');
    s.src = '//healthynumerics.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript class="text-muted">
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
	      <li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/categories.html">Categories</a></li>
			<li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/tags.html">Tags</a></li>
          <li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/archives.html">Archives</a></li>
			<li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/authors.html">Authors</a></li>
        </ul>	
        <p style="color:#C0C0C0;"> 
		    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> 
		    based on the <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">alchemy &#x2728;</a> theme
           </p>
      </div>
    </div>
  </footer>
</body>

</html>