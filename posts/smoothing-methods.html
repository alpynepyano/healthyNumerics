<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <title>Moving Average = Diffusion = Markov Chain = Monte Carlo | HealthyNumerics
</title>
  <link rel="canonical" href="https://alpynepyano.github.io/healthyNumerics/posts/smoothing-methods.html">


  <link rel="apple-touch-icon" href="https://alpynepyano.github.io/healthyNumerics/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://alpynepyano.github.io/healthyNumerics/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://alpynepyano.github.io/healthyNumerics/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://alpynepyano.github.io/healthyNumerics/manifest.json">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://alpynepyano.github.io/healthyNumerics/theme/css/style.css">
 

<meta name="description" content="We compare 4 numerical principles that have smoothing and/or time marching properties and show the similarities between them.">
<!-- base href="http://localhost:8000/output/images" / -->
<!-- base href="http://localhost:8000/" -->
<!--base href="/" / -->
</head>

<body>



       <!-- 
	   <div class="container-fluid"> <img class="img-fluid" src= "h01.jpg"> </div>
	   <div style="background-image: url(https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg) </div>
	   <style> body { background: #ffffff url("http://localhost:8000/images/b04.jpg") no-repeat center top; } </style>	 
	   <body background="bgimage.jpg">	   
	   body { background-image: url("img_tree.gif"), url("img_flwr.gif");
              background-color: #cccccc;
              }
	   -->

	  

  <header class="header">
    <div class="container">
      <div class="row">
	  
        <style> body { background: #ffffff 
		               url(https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg) no-repeat center top; }
		</style>
		<p class="text-hide"> .</p> <p class="text-hide"> .</p>
		<p class="text-hide"> .</p> <p class="text-hide"> .</p> <p class="text-hide"> .</p>
        <!--img  src="https://alpynepyano.github.io/healthyNumerics/siteImages/b04.jpg"-->		
  
		
        <div class="col-sm-4">
          <a href="https://alpynepyano.github.io/healthyNumerics">
            <img class="img-fluid" src=https://alpynepyano.github.io/healthyNumerics/siteImages/profile.png alt="HealthyNumerics">
          </a>
        </div>
        <div class="col-sm-8">
		
      
		  <h1 class="title"   > <a style=" color:white" href="https://alpynepyano.github.io/healthyNumerics">HealthyNumerics</a> </h1>
		  
		  
		  <p style="color:white; font-size:16pt;"  > HealthPoliticsEconomics  |  Quant Analytics  |  Numerics </p>

		  
          <ul class="list-inline">
            <li class="list-inline-item"><a style="color:#ccccff;" href="http://derProjektor.ch/" target="_blank">der Projektor</a></li>
			<li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a style="color:#ccccff;" href="http://Abdagon.com/" target="_blank">Health Systems</a></li>
			<li class="list-inline-item text-muted">|</li>
			
			

		
			
            <li class="list-inline-item"><a class="fa fa-linkedin" style=" color:white;"   href="https://ch.linkedin.com/in/peter-schuhmacher" target="_blank"></a></li>
            <li class="list-inline-item text-muted">|</li>

		
			
            <li class="list-inline-item"><a class="fa fa-twitter" style=" color:white;"   href="https://twitter.com/PeSchuh" target="_blank"></a></li>
            <li class="list-inline-item text-muted">|</li>
          </ul>
        </div>
		
		
		
		
        <div class="col-sm-8">
		<ul class="list-inline">
		  <li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/categories.html">Categories</a></li>
		  <li class="list-inline-item text-muted">|</li>
			<li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/tags.html">Tags</a></li>
			<li class="list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/archives.html">Archives</a></li>
		  <li class="list-inline-item text-muted">|</li>
			<li class="list-inline-item"><a style="color:white" href="https://alpynepyano.github.io/healthyNumerics/authors.html">Authors</a></li>
          </ul>
        </div>
		
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>Moving Average = Diffusion = Markov Chain = Monte Carlo
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2019-02-06T16:30:00+01:00">
        <i class="fa fa-clock-o"></i>
        Mi 06 Februar 2019
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/category/computationalfluiddynamics.html">ComputationalFluidDynamics</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/author/peter-schuhmacher.html">Peter Schuhmacher</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="https://alpynepyano.github.io/healthyNumerics/tag/numerical-schemas.html">#numerical schemas</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/fvm.html">#FVM</a>,         <a href="https://alpynepyano.github.io/healthyNumerics/tag/finite-volume-method.html">#finite volume method</a>      </li>
    </ul>
  </header>
  <div class="content">
    <p>We compare 4 numerical principles that have smoothing and/or time marching properties and show the similarities between them.</p>
<p>Let's  look at the 1-dimensional case first and let's assume that we have a data series with the connectivity given by the following images. We will use the local compass notation where the central point under consideration is denoted with P and the neighbouring points to the right and to the left with W (=west) and E (=east).</p>
<div class="highlight"><pre><span></span><span class="n">d1</span>
</pre></div>
<p><img alt="svg" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_2_0.svg"/></p>
<h1>Moving Average = Diffusion = Markov Chain = Monte Carlo</h1>
<p><strong>Moving average</strong> | A common and simple schema for smoothing is the moving average with a filter length of 3 elements and with weights <span class="math">\((1, 2, 1)/4\)</span>:</p>
<div class="math">\begin{equation}
\begin{array}{lcl}
T^1_P &amp; = &amp; (T^0_W + 2T^0_P + T^0_E)/4 \\
      &amp; = &amp;  0.25\,T^0_W + 0.5\,T^0_P + 0.25\,T^0_W
\end{array} 
\end{equation}</div>
<p><strong>Diffusion</strong> | Difffusion is a physcical concept and the smoothing properties to reduce differences are well known. A formal similarity to the <strong>moving avarage</strong> is given with the discretisation of the time dependent diffusion equation. If we scale the term <span class="math">\((\Delta x)^2 / \Delta t\)</span> to 4 then we get:</p>
<div class="math">\begin{equation}
\begin{array}{rcl}
T_t &amp; = &amp; \nabla^2 T \\
T^1_P - T^0_P &amp; = &amp; (T^0_W - 2T^0_P + T^0_E)\,\Delta t / (\Delta x)^2\\
        &amp; = &amp;  0.25\,T^0_W - 0.5\,T^0_P + 0.25\,T^0_W \\
T^1_P   &amp; = &amp;  0.25\,T^0_W + 0.5\,T^0_P + 0.25\,T^0_W \\
\end{array} 
\end{equation}</div>
<p><strong>Markov chain</strong> | The stencil as given by the discretisised <strong>difffusion equation</strong> can be used the build the complete system matrix <strong>D</strong> which has the structure</p>
<div class="highlight"><pre><span></span> [[1.   0.   0.   0.   0.   0.   0.   0.  ]
  [0.25 0.5  0.25 0.   0.   0.   0.   0.  ]
  [0.   0.25 0.5  0.25 0.   0.   0.   0.  ]
  [0.   0.   0.25 0.5  0.25 0.   0.   0.  ]
  [0.   0.   0.   0.25 0.5  0.25 0.   0.  ]
  [0.   0.   0.   0.   0.25 0.5  0.25 0.  ]
  [0.   0.   0.   0.   0.   0.25 0.5  0.25]
  [0.   0.   0.   0.   0.   0.   0.   1.  ]]
</pre></div>
<p>We have now the mathematical form of a <strong>Markov chain</strong> where status <span class="math">\(T^0\)</span> changes to the new status <span class="math">\(T^1\)</span> with</p>
<div class="math">\begin{equation}
\begin{array}{rcl}
T^0 &amp; \xrightarrow{\mathbf{D}} &amp; T^1 \\
    &amp;   &amp; T^1 = \mathbf{D} \cdot T^0  \\
\end{array} 
\end{equation}</div>
<p><strong>Monte Carlo, MC</strong> | We can use the diffusion approach once more and imagine that a physical particle randomly stays either at its starting point P or moves to one of the neighbouring points W or E. If we assume that the particle stays with probability <span class="math">\(p=0.5\)</span> at the position where it is and changes with probability <span class="math">\(p=0.25\)</span> to one of the neighbouring points, then we have the probabilistic counter part to the discretizised partial differential equation of diffusion.</p>
<div class="highlight"><pre><span></span><span class="n">d2</span>
</pre></div>
<p><img alt="svg" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_4_0.svg"/></p>
<h2>Example: Diffusion vs Moving Average</h2>
<p>In the following example we use the diffusion equation in the stationary form und resolve for the central point <span class="math">\(P\)</span> by a Gauss-Seidel principle. For simplicity we use <span class="math">\(\Delta x = 1\)</span>.</p>
<div class="math">\begin{equation}
\begin{array}{rcl}
\nabla^2 T &amp; = &amp;  0    &amp; \text{Diffusion without any sinks or sources}\\
           &amp; = &amp; (T^0_W - 2T^0_P + T^0_E)\, / \,(\Delta x)^2 &amp; \text{discretized form} \\
    T^0_P  &amp; = &amp;  (T^0_W  + T^0_E)\, / \, 2 &amp; \text{resolve for the central point under consideration}\\
T^1_P   &amp; := &amp;  (T^0_W  + T^0_E)\, / \, 2 &amp; \text{algorithmic Gauss-Seidel form}\\
\end{array} 
\end{equation}</div>
<p>The last equation is the numerical schema which is one possibility to solve the system equation by the Gauss-Seidel principle. The algorithmic formula of the diffusion is now a moving average with 2 elements only. This is more efficient for smoothing than the formula for the moving average with 3 elements. Both algorithms converge to the same solution, which is a straight line between the boundary points.</p>
<h1>Numerical example: Diffusion vs Moving Average</h1>
<p>We compare the Diffusion with the Moving Average method by a numerical example. Both methods are explicite forwad in time. The resulting plot shows that the diffusion method is a more efficient smoother after the first time step. But both methods converge to the same result after 5 time steps.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">generate_data_1</span><span class="p">(</span><span class="n">case</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">case</span><span class="o">==</span><span class="s1">'A'</span><span class="p">:</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">scale</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">z</span><span class="o">*</span><span class="n">z</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">case</span><span class="o">==</span><span class="s1">'B'</span><span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">scale</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">case</span><span class="o">==</span><span class="s1">'C'</span><span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">case</span><span class="o">==</span><span class="s1">'R'</span><span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">x</span><span class="p">;</span> <span class="n">n4</span><span class="o">=</span><span class="n">N</span><span class="o">//</span><span class="mi">4</span><span class="p">;</span> <span class="n">y</span><span class="p">[</span><span class="n">n4</span><span class="p">:</span><span class="o">-</span><span class="n">n4</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span>

<span class="k">def</span> <span class="nf">MovingAverage</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
    <span class="n">nx</span><span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">jxm</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>  <span class="n">jx</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">jxp</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>   
    <span class="n">Za</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
    <span class="n">Za</span><span class="p">[</span><span class="n">jx</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">jxp</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Z</span><span class="p">[</span><span class="n">jx</span><span class="p">]</span> <span class="o">+</span> <span class="n">Z</span><span class="p">[</span><span class="n">jxm</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span>
    <span class="k">return</span> <span class="n">Za</span>

<span class="k">def</span> <span class="nf">Diffusion</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
    <span class="n">nx</span><span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">jxm</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>  <span class="n">jx</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">jxp</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">nx</span><span class="p">)</span>   
    <span class="n">Zxx</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  
    <span class="n">Zxx</span><span class="p">[</span><span class="n">jx</span><span class="p">]</span> <span class="o">=</span>  <span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">jxp</span><span class="p">]</span>  <span class="o">+</span> <span class="n">Z</span><span class="p">[</span><span class="n">jxm</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">Zxx</span>

<span class="k">def</span> <span class="nf">plot_line_1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span> <span class="s1">'b+--'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'inital status at t=0'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span> <span class="s1">'co-'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'moving average at t'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span> <span class="s1">'mo-'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'diffusion at t'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#------------- main -----------------------------------------</span>
<span class="n">Nn</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">x</span><span class="p">,</span><span class="n">v0</span> <span class="o">=</span> <span class="n">generate_data_1</span><span class="p">(</span><span class="s1">'B'</span><span class="p">,</span><span class="n">Nn</span><span class="p">)</span>  <span class="c1">#B, 10</span>

<span class="n">v1</span> <span class="o">=</span> <span class="n">MovingAverage</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">Diffusion</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'ggplot'</span><span class="p">):</span>  
    <span class="n">plot_line_1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span> <span class="s1">'Smoothing after 1 time step'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">MovingAverage</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">Diffusion</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'ggplot'</span><span class="p">):</span>  
    <span class="n">plot_line_1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span> <span class="s1">'Smoothing after 5 time steps'</span><span class="p">)</span>
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_8_0.png"/></p>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_8_1.png"/></p>
<h1>Numerical example: Diffusion by Monte Carlo method</h1>
<p>Ther are different possibilities to implement a Monte Carlo method for diffusion. In this example we imagine, that the given data points are particles that have the given temperature. The particles can move to the right and to the left but will not change the temperature. Collisions or friction with other particles are not considered.</p>
<p>We run Nt=1000 timesteps where the status changes from <span class="math">\(v_t\)</span> to <span class="math">\(v_{t+1}\)</span>. At each change <span class="math">\(v_{t+1}\)</span> decides whether it takes at position P the same value <span class="math">\(v(P)_t\)</span> with probability <span class="math">\(p=0.5\)</span> or whether it takes the value of one of the neighbouring points  <span class="math">\(v(W)_t\)</span> or  <span class="math">\(v(E)_t\)</span> with probability <span class="math">\(p=0.25\)</span> each. We sum up  all <span class="math">\(v_t\)</span> elementwise and build the mean over all timestpes Nt as final result.</p>
<p>In the graphical output we can recognize a smoothing of the major differences during the first few time steps. The steady state is reached with a lower convergence rate.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_line_2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span> <span class="s1">'b+--'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'inital status at t=0'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span> <span class="s1">'co-'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'moving average at t'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span> <span class="s1">'mo-'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'diffusion at t'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



<span class="c1">#------------- main -----------------------------------------</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="mi">1000</span>       <span class="c1"># number of iterations</span>
<span class="n">Nmod</span> <span class="o">=</span> <span class="mi">20</span>    <span class="c1"># modulo for printing</span>
<span class="n">Nn</span> <span class="o">=</span> <span class="mi">10</span>      <span class="c1"># number of points</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">v0</span> <span class="o">=</span> <span class="n">generate_data_1</span><span class="p">(</span><span class="s1">'B'</span><span class="p">,</span><span class="n">Nn</span><span class="p">)</span>
<span class="n">vAll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nn</span><span class="p">)</span>
<span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nn</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nn</span><span class="p">)</span> 

<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'ggplot'</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span> <span class="s1">'b+--'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'inital status at t=0'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>        
    <span class="k">for</span> <span class="n">jt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">):</span>
        <span class="n">dind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Nn</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">])</span>
        <span class="n">dind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dind</span><span class="p">[</span><span class="n">Nn</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">ind1</span> <span class="o">+</span> <span class="n">dind</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">v0</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>
        <span class="n">vAll</span> <span class="o">=</span> <span class="n">vAll</span> <span class="o">+</span> <span class="n">v1</span>
        <span class="c1">#if (jt-1)%Nmod == 0:</span>
        <span class="k">if</span> <span class="n">jt</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">'plot at jt='</span><span class="p">,</span><span class="n">jt</span><span class="p">)</span>
            <span class="n">vPlot</span> <span class="o">=</span> <span class="n">vAll</span><span class="o">/</span><span class="p">(</span><span class="n">jt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">vPlot</span><span class="p">,</span>  <span class="n">ms</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">vAll</span> <span class="o">=</span> <span class="n">vAll</span><span class="o">/</span><span class="n">Nt</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">vAll</span><span class="p">,</span> <span class="s1">'mo-'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Monte Carlo final'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Diffusion by Monte Carlo Method'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span>plot at jt= 0
plot at jt= 1
plot at jt= 2
plot at jt= 3
plot at jt= 4
plot at jt= 5
plot at jt= 6
plot at jt= 7
plot at jt= 8
plot at jt= 9
plot at jt= 10
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_11_1.png"/></p>
<h1>Numerical example: Markov Chain method</h1>
<p>A <strong>Markov chain</strong> changes status <span class="math">\(T^0\)</span> to the new status <span class="math">\(T^1\)</span> with matrix <span class="math">\(M\)</span></p>
<div class="math">\begin{equation}
\begin{array}{rcl}
T^0 &amp; \xrightarrow{\mathbf{M}} &amp; T^1 \\
    &amp;   &amp; T^1 = \mathbf{M} \cdot T^0  \\
\end{array} 
\end{equation}</div>
<p>Matrix <span class="math">\(M\)</span> can express different things, e.g. Moving Avaerage (MA) or Diffusion (D). The <strong>local stencils</strong> are:</p>
<div class="math">\begin{equation}
\begin{array}{rcl}
  T^1_P    &amp; = &amp; (0.25T^0_W - 0.5T^0_P + 0.25T^0_E) &amp; \text{Diffusion, explicite discretized form} \\
  T^1_P    &amp; = &amp; (0.25T^0_W + 0.5T^0_P + 0.25T^0_E) &amp; \text{Moving Average } \\
\end{array} 
\end{equation}</div>
<p>We get the <strong>global system matrix M</strong> by bringing all the local stencils together. For the Moving Average matrix <span class="math">\(M\)</span> is:</p>
<div class="highlight"><pre><span></span> [[1.   0.   0.   0.   0.   0.   0.   0.  ]
  [0.25 0.5  0.25 0.   0.   0.   0.   0.  ]
  [0.   0.25 0.5  0.25 0.   0.   0.   0.  ]
  [0.   0.   0.25 0.5  0.25 0.   0.   0.  ]
  [0.   0.   0.   0.25 0.5  0.25 0.   0.  ]
  [0.   0.   0.   0.   0.25 0.5  0.25 0.  ]
  [0.   0.   0.   0.   0.   0.25 0.5  0.25]
  [0.   0.   0.   0.   0.   0.   0.   1.  ]]
</pre></div>
<p>For the Diffusion the <span class="math">\(0.5\)</span> in the diagonal would become <span class="math">\(-0.5\)</span>. The elements with <span class="math">\(1.\)</span> make shure that the boundary values do not change.</p>
<p>In the graphical output we can recognize that the Moving Average converges within a few timesteps close to steady state. At the end the Markov Chain is a different algorithmic form of programming the Moving Average on the data vector as shown above.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">MarkovMatrix_fixed_BC</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">D</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>       \
       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="mi">1</span><span class="p">)</span> \
       <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span>    <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">D</span><span class="o">/</span><span class="mf">4.0</span>
    <span class="n">D</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>  <span class="n">D</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">D</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>  <span class="n">D</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">return</span> <span class="n">D</span>
<span class="c1">#------------- main -----------------------------------------</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="mi">7</span>                                    <span class="c1"># number of iterations</span>
<span class="n">Nmod</span> <span class="o">=</span> <span class="mi">20</span>                                 <span class="c1"># modulo for printing</span>
<span class="n">Nn</span> <span class="o">=</span> <span class="mi">10</span>                                   <span class="c1"># number of data points</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">MarkovMatrix_fixed_BC</span><span class="p">(</span><span class="n">Nn</span><span class="p">)</span>              <span class="c1"># set up Markov Matrix with fixed boundary conditions</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'-----------------------------------------------------'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Markov Transition Matrix M:"</span><span class="p">);</span> 
<span class="k">print</span><span class="p">(</span><span class="s1">'-----------------------------------------------------'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">M</span><span class="p">);</span> <span class="k">print</span><span class="p">(</span><span class="s1">'-----------------------------------------------------'</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span><span class="n">v0</span> <span class="o">=</span> <span class="n">generate_data_1</span><span class="p">(</span><span class="s1">'B'</span><span class="p">,</span><span class="n">Nn</span><span class="p">)</span>             <span class="c1"># initialize the data vector</span>


<span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="s1">'ggplot'</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span> <span class="s1">'b+--'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.55</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'inital status at t=0'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span><span class="n">vmin</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'b'</span><span class="p">)</span>        
    <span class="k">for</span> <span class="n">jt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">):</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">v0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">vAll</span> <span class="o">=</span> <span class="n">vAll</span><span class="o">/</span><span class="n">Nt</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">v0</span><span class="p">,</span> <span class="s1">'mo-'</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Markov Chain final'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Moving Average by Markov Chain Method'</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">'bold'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">'size'</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span>-----------------------------------------------------
Markov Transition Matrix M:
-----------------------------------------------------
[[1.   0.   0.   0.   0.   0.   0.   0.   0.   0.  ]
 [0.25 0.5  0.25 0.   0.   0.   0.   0.   0.   0.  ]
 [0.   0.25 0.5  0.25 0.   0.   0.   0.   0.   0.  ]
 [0.   0.   0.25 0.5  0.25 0.   0.   0.   0.   0.  ]
 [0.   0.   0.   0.25 0.5  0.25 0.   0.   0.   0.  ]
 [0.   0.   0.   0.   0.25 0.5  0.25 0.   0.   0.  ]
 [0.   0.   0.   0.   0.   0.25 0.5  0.25 0.   0.  ]
 [0.   0.   0.   0.   0.   0.   0.25 0.5  0.25 0.  ]
 [0.   0.   0.   0.   0.   0.   0.   0.25 0.5  0.25]
 [0.   0.   0.   0.   0.   0.   0.   0.   0.   1.  ]]
-----------------------------------------------------
</pre></div>
<p><img alt="png" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_13_1.png"/></p>
<h1>Filtering by implicit partial differential equations or by statistical methods</h1>
<p>All the proposed methods use an explicite forward timestep. This in so far not satisfying as the final result depends on how many time steps are chosen.
There are more sophisticated methods which use implicit partial differential equations as filtering schemes. In a <strong>separate article</strong> we will present <strong>three</strong> approaches:</p>
<ol>
<li>Raymond and Garder have developed an implicit method in connection with numerical meteorological studies which are meanwhile widely used in computational aeroacoustics and image processing.</li>
<li>we will present our approach which uses both the initial data as driving force with a generating property and the filter with a smoothing property. The solution is a steady state between the generating und the smoothing forces.</li>
<li>a Gaussian processes (GP) for regression purposes as a statistical method. For this, the prior of the GP needs to be specified. A regression can be considered as a smoothing of a data set.</li>
</ol>
<div class="highlight"><pre><span></span>
</pre></div>
<div class="highlight"><pre><span></span>
</pre></div>
<h1><em>Appendix: Graphics with graphviz</em></h1>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">graphviz</span> <span class="kn">as</span> <span class="nn">gv</span>
<span class="k">def</span> <span class="nf">plotMarkovModel</span><span class="p">():</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">Digraph</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">'png'</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'cornflowerblue'</span><span class="p">,</span><span class="s1">'orangered'</span><span class="p">,</span><span class="s1">'orange'</span><span class="p">,</span><span class="s1">'chartreuse'</span><span class="p">,</span><span class="s1">'lightgrey'</span><span class="p">]</span>
    <span class="c1">#d1.node('A','A (healthy)', style='filled', color=c[0])</span>
    <span class="c1">#d1.node('B','B (infected)',style='filled', color=c[1])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'0'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'E'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'n'</span><span class="p">,</span><span class="s1">'n'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>

    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'0'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> 
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'0'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'...'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'...'</span><span class="p">,</span><span class="s1">'...'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'...'</span><span class="p">,</span><span class="s1">'1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'...'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>    
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'...'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'w+'</span><span class="p">)</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'w-'</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'e-'</span><span class="p">)</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'E'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'E'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'e+'</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'E'</span><span class="p">,</span><span class="s1">'....'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'....'</span><span class="p">,</span><span class="s1">'....'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'....'</span><span class="p">,</span><span class="s1">'n-1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'....'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>     
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'n-1'</span><span class="p">,</span><span class="s1">'n-1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'n-1'</span><span class="p">,</span><span class="s1">'....'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'n-1'</span><span class="p">,</span><span class="s1">'n'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'n'</span><span class="p">,</span><span class="s1">'n'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'n'</span><span class="p">,</span><span class="s1">'n-1'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">);</span> 
    <span class="n">d1</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rankdir</span><span class="o">=</span><span class="s1">'LR'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d1</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">plotMarkovModel</span><span class="p">()</span>
<span class="c1">#d1.render('img/mamo1', view=True)</span>
<span class="n">d1</span>
</pre></div>
<p><img alt="svg" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_18_0.svg"/></p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plotMCMC</span><span class="p">():</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">gv</span><span class="o">.</span><span class="n">Digraph</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">'png'</span><span class="p">,</span><span class="n">engine</span><span class="o">=</span><span class="s1">'dot'</span><span class="p">)</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rankdir</span><span class="o">=</span><span class="s1">'LR'</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'cornflowerblue'</span><span class="p">,</span><span class="s1">'orangered'</span><span class="p">,</span><span class="s1">'orange'</span><span class="p">,</span><span class="s1">'chartreuse'</span><span class="p">,</span><span class="s1">'lightgrey'</span><span class="p">]</span>

    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'W'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">d1</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s1">'E'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span>    <span class="n">style</span><span class="o">=</span><span class="s1">'filled'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'0.5'</span><span class="p">);</span> <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'P'</span><span class="p">,</span><span class="s1">'E'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'0.25'</span><span class="p">)</span> 
    <span class="n">d1</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s1">'W'</span><span class="p">,</span><span class="s1">'P'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'0.25'</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s1">'inv'</span><span class="p">);</span>  <span class="c1">#d1.edge('P','W',label='0.25');</span>
    <span class="k">return</span> <span class="n">d1</span>
<span class="n">d2</span> <span class="o">=</span> <span class="n">plotMCMC</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="n">d2</span>
</pre></div>
<p><img alt="svg" class="img-fluid" src="https://alpynepyano.github.io/healthyNumerics/posts/img2109/output_20_0.svg"/></p>
<div class="highlight"><pre><span></span>
</pre></div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
</article>
<hr>
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() {
    this.page.url = 'https://alpynepyano.github.io/healthyNumerics/posts/smoothing-methods.html';
    this.page.identifier = 'smoothing-methods';
  };
  (function() {
    var d = document;
    var s = d.createElement('script');
    s.src = '//healthynumerics.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript class="text-muted">
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
	      <li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/categories.html">Categories</a></li>
			<li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/tags.html">Tags</a></li>
          <li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/archives.html">Archives</a></li>
			<li class="list-inline-item"><a href="https://alpynepyano.github.io/healthyNumerics/authors.html">Authors</a></li>
        </ul>	
        <p style="color:#C0C0C0;"> 
		    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> 
		    based on the <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">alchemy &#x2728;</a> theme
           </p>
      </div>
    </div>
  </footer>
</body>

</html>